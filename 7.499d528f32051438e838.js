(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{hC93:function(n,t,e){"use strict";e.d(t,"a",function(){return p});var i=e("mrSG"),r=e("cqKM"),o=e("AytR"),a=e("FRnW"),l=e("CcnG"),c=e("Nx7O"),u=e("p8Wi"),s=e("45lj"),f=e("DMq5"),p=function(){function n(n,t,e,i){this.proximaxProvider=n,this.serviceModuleService=t,this.walletService=e,this.transactionService=i,this.consginerFirmList=[]}return n.prototype.multisigCosignatoryModification=function(n){var t=[];if(n.length>0)for(var e=0;e<n.length;e++)t.push(new r.MultisigCosignatoryModification(1===n[e].type?r.MultisigCosignatoryModificationType.Add:r.MultisigCosignatoryModificationType.Remove,n[e].publicAccount));return t},n.prototype.aggregateTransactionEditModifyMultisig=function(n){console.log("params",n);var t=this.calcMinDelta(n.minApprovalDelta.minApprovalOld,n.minRemovalDelta.minRemovalOld,n.minApprovalDelta.minApprovalNew,n.minRemovalDelta.minRemovalNew),e=r.ModifyMultisigAccountTransaction.create(r.Deadline.create(o.a.deadlineTransfer.deadline,o.a.deadlineTransfer.chronoUnit),t.minApprovalDelta,t.minRemovalDelta,this.multisigCosignatoryModification(n.cosignatoryLis),o.a.typeNetwork.value),i=this.typeSignTxEdit(n.cosignatoryLis,n.minRemovalDelta.minRemovalOld,n.minApprovalDelta.minApprovalOld,n.cosignerFirmList,n.accountsWallet);return console.log("typeTX",i),i===r.TransactionType.AGGREGATE_BONDED?r.AggregateTransaction.createBonded(r.Deadline.create(o.a.deadlineTransfer.deadline,o.a.deadlineTransfer.chronoUnit),[e.toAggregate(n.account)],n.account.address.networkType):r.AggregateTransaction.createComplete(r.Deadline.create(o.a.deadlineTransfer.deadline,o.a.deadlineTransfer.chronoUnit),[e.toAggregate(n.account)],n.account.address.networkType,[])},n.prototype.calcMinDelta=function(n,t,e,i){return new Object({minApprovalDelta:e-n,minRemovalDelta:i-t})},n.prototype.aggregateTransactionModifyMultisig=function(n){var t=n.othersCosignatories.concat(n.ownCosignatories),e=t.map(function(n){return new r.MultisigCosignatoryModification(r.MultisigCosignatoryModificationType.Add,n)}),i=r.ModifyMultisigAccountTransaction.create(r.Deadline.create(o.a.deadlineTransfer.deadline,o.a.deadlineTransfer.chronoUnit),n.minApprovalDelta,n.minRemovalDelta,e,n.account.address.networkType);return this.validateTypeSignTxn(n.ownCosignatories,t)===r.TransactionType.AGGREGATE_BONDED?r.AggregateTransaction.createBonded(r.Deadline.create(o.a.deadlineTransfer.deadline,o.a.deadlineTransfer.chronoUnit),[i.toAggregate(n.account)],n.account.address.networkType):r.AggregateTransaction.createComplete(r.Deadline.create(o.a.deadlineTransfer.deadline,o.a.deadlineTransfer.chronoUnit),[i.toAggregate(n.account)],n.account.address.networkType,[])},n.prototype.convertAccountToMultisig=function(n){var t=n.othersCosignatories.concat(n.ownCosignatories.map(function(n){return n.publicAccount})).map(function(n){return new r.MultisigCosignatoryModification(r.MultisigCosignatoryModificationType.Add,n)});r.ModifyMultisigAccountTransaction.create(r.Deadline.create(),n.minApprovalDelta,n.minRemovalDelta,t,n.account.address.networkType)},n.prototype.checkIsMultisig=function(n){var t=!1;return n.isMultisign&&(t=0!==n.isMultisign.minRemoval&&0!==n.isMultisign.minApproval),Boolean(null!=n.isMultisign&&t)},n.prototype.chechOwnCosignatoriesIsMultisig=function(n){var t,e,r=!1;try{for(var o=i.__values(n),a=o.next();!a.done;a=o.next()){var l=this.walletService.filterAccountInfo(a.value.address.pretty(),!0);if(l&&(r=null!=l.multisigInfo&&l.multisigInfo.isMultisig()))break}}catch(c){t={error:c}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return r},n.prototype.signedTransaction=function(n,t,e,i){return i.length>0?n.signTransactionWithCosignatories(t,i,e):n.sign(t,e)},n.prototype.filterOwnCosignatories=function(n,t){return n.map(function(n){return t.find(function(t){return n.publicKey===t.publicAccount.publicKey})}).filter(function(n){return void 0!==n})},n.prototype.filterOwnCosignatory=function(n,t){return t.find(function(t){return t.publicAccount.publicKey===n.publicKey})},n.prototype.filterOtherCosignerFirmAccountList=function(n,t){var e,r,o=[],a=function(n){t.find(function(t){return n.account.address===t.account.address})||o.push(n)};try{for(var l=i.__values(n),c=l.next();!c.done;c=l.next())a(c.value)}catch(u){e={error:u}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return o},n.prototype.filterOthersCosignatories=function(n,t){var e,r,l=[],c=function(n){t.find(function(t){return n.publicKey===t.publicAccount.publicKey})||l.push(a.PublicAccount.createFromPublicKey(n.publicKey,o.a.typeNetwork.value))};try{for(var u=i.__values(n),s=u.next();!s.done;s=u.next())c(s.value)}catch(f){e={error:f}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return l},n.prototype.onPartial=function(n,t){var e,r,o=!1;if(null!==t&&t.length>0)try{for(var a=i.__values(t),l=a.next();!l.done;l=a.next()){for(var c=l.value,u=0;u<c.data.innerTransactions.length&&!(o=c.data.innerTransactions[u].signer.publicKey===n.publicAccount.publicKey);u++);if(o)break}}catch(s){e={error:s}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},n.prototype.validateTypeSignTxn=function(n,t){var e=t.filter(function(t){return n.find(function(n){return n.publicKey===t.publicKey})});return null==e||0===e.length?r.TransactionType.AGGREGATE_BONDED:e.length!==t.length||this.chechOwnCosignatoriesIsMultisig(e)?r.TransactionType.AGGREGATE_BONDED:r.TransactionType.AGGREGATE_COMPLETE},n.prototype.multisigAccountGraphInfoMap=function(n){var t=[];return n.multisigAccounts.forEach(function(n){var e,r;if(n.length>0)try{for(var o=i.__values(n),a=o.next();!a.done;a=o.next())t.push(a.value)}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}else t.push(n)}),t},n.prototype.typeSignTxEdit=function(n,t,e,i,o){var a=i.length;a=a>0?a:1;var l=this.filterOwnCosignatories(n.map(function(n){return{publicKey:n.publicAccount.publicKey}}),o),c=n.filter(function(n){return 1===n.type}).length,u=n.filter(function(n){return 2===n.type}).length;return console.log("cantAdd",c),console.log("cabtRemove",u),console.log("cantFirm",a),console.log("ownCosignatories",l),console.log("cosignatoryList",n),!Boolean(l.length===n.length)&&c>0?r.TransactionType.AGGREGATE_BONDED:c>0&&u>0?(console.log("ADD Y REMOVE"),a>=t&&a>=e?r.TransactionType.AGGREGATE_COMPLETE:r.TransactionType.AGGREGATE_BONDED):0===c&&0===u?(console.log("NEVER"),a>=t&&a>=e?r.TransactionType.AGGREGATE_COMPLETE:r.TransactionType.AGGREGATE_BONDED):c>0?(console.log("ADD"),a>=e?r.TransactionType.AGGREGATE_COMPLETE:r.TransactionType.AGGREGATE_BONDED):u>0?(console.log("REMOVE"),a>=t?r.TransactionType.AGGREGATE_COMPLETE:r.TransactionType.AGGREGATE_BONDED):void 0},n.prototype.validateOwnCosignatories=function(n,t){var e,r;void 0===t&&(t=/^(0x|0X)?[a-fA-F0-9]+$/);var o=!0;try{for(var a=i.__values(n),l=a.next();!l.done;l=a.next()){var c=l.value;if(!t.test(c.publicKey)||c.publicKey.length<64){o=!1;break}}}catch(u){e={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},n.prototype.validatePublicKey=function(n,t){return void 0===t&&(t=/^(0x|0X)?[a-fA-F0-9]+$/),!(!t.test(n)||n.length<64)},n.prototype.buildCosignatory=function(n,t,e){var i=this.walletService.filterAccountInfo(n.name);if(i){var r=i&&i.multisigInfo&&i.multisigInfo.cosignatories.length>0,o=null;return t&&(o=this.transactionService.validateBalanceCosignatorie(i,Number(t)).infValidate),{label:r?n.name+" - Multisig":n.name,value:n.address,disabled:o&&o[0].disabled||r,info:o&&o[0].info,account:n,isMultisig:n.isMultisign,accountIsMultisig:r,accountFiltered:i}}return null},n.prototype.buildCosignerList=function(n,t,e){var r,o,l=this;if(n){var c=[],u=function(t){var i=a.PublicAccount.createFromPublicKey(t.publicAccount.publicKey,t.network);if(n.hasCosigner(i)){var r=s.buildCosignatory(t,e);r&&(c.push(r),r.accountIsMultisig&&r.accountFiltered.multisigInfo.cosignatories.forEach(function(n){var t=l.walletService.filterAccountWallet("",null,n.address.pretty());if(t){var i=l.buildCosignatory(t,e,r.account.name);i&&(c.find(function(n){return n.account.publicAccount.publicKey===i.account.publicAccount.publicKey})||c.push(i),i.accountIsMultisig&&i.accountFiltered.multisigInfo.cosignatories.forEach(function(n){var t=l.walletService.filterAccountWallet("",null,n.address.pretty());if(t){var r=l.buildCosignatory(t,e,i.account.name);r&&(c.find(function(n){return n.account.publicAccount.publicKey===r.account.publicAccount.publicKey})||c.push(r))}}))}}))}},s=this;try{for(var f=i.__values(t),p=f.next();!p.done;p=f.next())u(p.value)}catch(d){r={error:d}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}return c}return[]},n.prototype.hasCosignerInCurrentWallet=function(n,t){var e,r,o=0;try{for(var l=i.__values(t),c=l.next();!c.done;c=l.next()){var u=c.value,s=a.PublicAccount.createFromPublicKey(u.publicAccount.publicKey,u.network);n.hasCosigner(s)&&o++}}catch(f){e={error:f}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return o},n.prototype.validateAccountListContact=function(n){var t,e,r=[],o=this.serviceModuleService.getBooksAddress();if(null!=o){var a=o.filter(function(t){return t.label!==n});try{for(var l=i.__values(a),c=l.next();!c.done;c=l.next()){var u=c.value,s=this.walletService.filterAccountWallet(u.label),f=!1,p=null;s&&(p=s.publicAccount.publicKey,f=this.checkIsMultisig(s)),r.push({label:u.label,value:u.value,publicKey:p,walletContact:u.walletContact,isMultisig:f,disabled:!1})}}catch(d){t={error:d}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}}return r},n.prototype.removeContactList=function(n,t){return n.map(function(n){if(!t.find(function(t){return t.address===n.value}))return n}).filter(function(n){return n})},n.ngInjectableDef=l.Tb({factory:function(){return new n(l.Xb(c.a),l.Xb(u.a),l.Xb(s.a),l.Xb(f.a))},token:n,providedIn:"root"}),n}()}}]);